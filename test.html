<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Python Execution in JavaScript</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/skulpt/0.11.5/skulpt.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/skulpt/0.11.5/skulpt-stdlib.js"></script>
  </head>
  <body>
    <script>
      function executePythonCode(codeBody, testCases, functionName) {
        // Configure Skulpt
        Sk.configure({
          output: (text) => {
            console.log(text);
          },
          read: (filename) => {
            if (
              Sk.builtinFiles === undefined ||
              Sk.builtinFiles["files"][filename] === undefined
            ) {
              throw new Error(`File not found: '${filename}'`);
            }
            return Sk.builtinFiles["files"][filename];
          },
        });

        // Run Python code and handle tests
        const pythonCode = `
${codeBody}
${handleTestFunction}
result = handle_tests(${JSON.stringify(testCases)}, ${functionName})
print(result)
`;

        // Execute Python code
        Sk.misceval.asyncToPromise(() =>
          Sk.importMainWithBody("<stdin>", false, pythonCode, true)
        );

        // Provide a callback for asynchronous execution if needed
        // Sk.afterSingleExecution(() => {
        //     console.log("Python code executed!");
        // });

        // Note: Skulpt's asynchronous behavior may require additional handling for more complex scenarios
      }

      // Sample test cases
      const testCases = [
        [[1, 2], 3],
        [[-1, 5], 4],
      ];

      // Sample Python code
      const pythonCode = `
def add_numbers(a, b):
    return a + b
`;

      // Sample function name
      const functionName = "add_numbers";

      // Sample handleTestFunction (replace with your actual implementation)
      const handleTestFunction = `
def handle_tests(test_cases, function_name):
    results = []
    for test_case in test_cases:
        input_data = test_case[0]   
        expected_output = test_case[1]
        try:
            user_output = globals()[function_name](*input_data)
            result = {
                "status": "Success" if user_output == expected_output else "Failure",
                "test_case_number": "undefined",
                "test_case": input_data,
                "expected_output": expected_output,
                "user_output": user_output,
            }
        except Exception as e:
            result = {
                "status": "Runtime Error",
                "test_case_number": "undefined",
                "test_case": input_data,
                "expected_output": expected_output,
                "user_output": "undefined",
                "error_message": str(e),
            }
        results.append(result)
    return results
`;

      // Execute Python code with tests
      executePythonCode(pythonCode, testCases, functionName);
    </script>
  </body>
</html>
